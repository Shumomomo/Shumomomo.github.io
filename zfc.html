<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>字符串.html</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="SynEdit HTML exporter" />
<style type="text/css">
<!--
body { color: #000000; background-color: #FFFFFF; }
.cpp1-assembler { color: #0000FF; }
.cpp1-character { color: #000000; }
.cpp1-comment { color: #0078D7; font-style: italic; }
.cpp1-float { color: #800080; }
.cpp1-hexadecimal { color: #800080; }
.cpp1-identifier { color: #000000; }
.cpp1-illegalchar { color: #000000; }
.cpp1-number { color: #800080; }
.cpp1-octal { color: #800080; }
.cpp1-preprocessor { color: #008000; }
.cpp1-reservedword { color: #000000; font-weight: bold; }
.cpp1-space { background-color: #FFFFFF; color: #000000; }
.cpp1-string { color: #0000FF; font-weight: bold; }
.cpp1-symbol { color: #FF0000; font-weight: bold; }
-->
</style>
</head>
<body>
<pre>
<code><span style="font: 21pt Consolas;"><span class="cpp1-illegalchar">字符串 Hash </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str01</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> ll mod</span><span class="cpp1-symbol">[</span><span class="cpp1-number">3</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-number">900000011</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">998244353</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">1000000007</span><span class="cpp1-symbol">};
</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> ll bas</span><span class="cpp1-symbol">[</span><span class="cpp1-number">3</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-number">4493</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">8111</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">8527</span><span class="cpp1-symbol">};
</span><span class="cpp1-comment">// you can choose your bases and modulos

</span><span class="cpp1-reservedword">char</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">S</span><span class="cpp1-symbol">];
</span><span class="cpp1-identifier">ll pw</span><span class="cpp1-symbol">[</span><span class="cpp1-number">3</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">S</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> Hash</span><span class="cpp1-symbol">[</span><span class="cpp1-number">3</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">S</span><span class="cpp1-symbol">];

</span><span class="cpp1-reservedword">inline</span><span class="cpp1-space"> ll getHash</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> id</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> L</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> R</span><span class="cpp1-symbol">){</span><span class="cpp1-space"> </span><span class="cpp1-comment">// str[L..R-1]
</span><span class="cpp1-space">	ll J </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">Hash</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">R</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> Hash</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">L</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-space"> pw</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">R </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> L</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> </span><span class="cpp1-symbol">%</span><span class="cpp1-space"> mod</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> J </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> J </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> mod</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> J</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-comment">// following is the pretreatment
</span><span class="cpp1-identifier">ll </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">g</span><span class="cpp1-symbol">;
</span><span class="cpp1-reservedword">for</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> j </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">++){
</span><span class="cpp1-space">	f </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> Hash</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	g </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pw</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> g</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">++){
</span><span class="cpp1-space">		f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-space"> bas</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> 'a'</span><span class="cpp1-symbol">))</span><span class="cpp1-space"> </span><span class="cpp1-symbol">%</span><span class="cpp1-space"> mod</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">		g</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> g</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-space"> bas</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">%</span><span class="cpp1-space"> mod</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
}
</span><span class="cpp1-identifier">KMP 模式匹配 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str02</span><span class="cpp1-symbol">]:

</span><span class="cpp1-comment">// pretreatment (border) 
</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">f </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">)
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">~</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!=</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]);

</span><span class="cpp1-comment">// KMP
</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> _n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">~</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!=</span><span class="cpp1-space"> m</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(++</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> printf</span><span class="cpp1-symbol">(</span><span class="cpp1-string">&quot;%d &quot;</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> s_n </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">);
}
</span><span class="cpp1-illegalchar">字典树 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str03</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">void</span><span class="cpp1-space"> append</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">char</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">){
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">char</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> t </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> id</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-comment">// t = 0 is also OK
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-symbol">(;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">){
</span><span class="cpp1-space">		id </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">97</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		t </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">V</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">];
}

</span><span class="cpp1-comment">// the process of matching is just like going on a DFA, so omit it.
</span><span class="cpp1-identifier">Aho</span><span class="cpp1-symbol">-</span><span class="cpp1-identifier">Corasick 自动机 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str04</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">void</span><span class="cpp1-space"> build</span><span class="cpp1-symbol">(){
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> h</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> ta </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> id</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	que</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	f</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">h </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> h </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> ta</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">h</span><span class="cpp1-symbol">)
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> que</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">h</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> id </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> id </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">26</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">){</span><span class="cpp1-space"> </span><span class="cpp1-comment">// 26 is the size of char-set
</span><span class="cpp1-space">			t </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]][</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">);</span><span class="cpp1-space"> </span><span class="cpp1-comment">// 1 or 0 depend on the root of trie
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;</span><span class="cpp1-identifier">u </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">id</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">if</span><span class="cpp1-symbol">(!</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-identifier">u </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">continue</span><span class="cpp1-symbol">;}
</span><span class="cpp1-space">			f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">|=</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> que</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">ta</span><span class="cpp1-symbol">++]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> u</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">			la</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">v</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> t </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> la</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">t</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">		</span><span class="cpp1-symbol">}
}
</span><span class="cpp1-illegalchar">后缀数组 </span><span class="cpp1-symbol">(</span><span class="cpp1-illegalchar">倍增构造</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> 与最长公共前缀 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str05</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">struct</span><span class="cpp1-space"> LCP </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">rnk</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">LN</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">	LCP </span><span class="cpp1-symbol">()</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">(</span><span class="cpp1-number">0</span><span class="cpp1-symbol">),</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">NULL</span><span class="cpp1-symbol">),</span><span class="cpp1-space"> rnk</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">NULL</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-identifier">memset</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">st</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">sizeof</span><span class="cpp1-space"> st</span><span class="cpp1-symbol">);}
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">~</span><span class="cpp1-identifier">LCP </span><span class="cpp1-symbol">()</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rnk</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> rnk</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> LN</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">void</span><span class="cpp1-space"> construct</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> k</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> m </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">256</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> p</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> limit</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> strlen</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">x </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">new</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">y </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">new</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">buf </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">new</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">max</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> m</span><span class="cpp1-symbol">)],</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">g </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">new</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">auto</span><span class="cpp1-space"> cmp </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[</span><span class="cpp1-reservedword">this</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">a</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> u</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> v</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> l</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> a</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> a</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">v</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">u </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> l </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> a</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> l</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">v </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> l </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> a</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">v </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> l</span><span class="cpp1-symbol">]);};
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> sa </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">new</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rnk</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> rnk</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> LN</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">		std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">sort</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> sa </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> u</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> v</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">char</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">v</span><span class="cpp1-symbol">];});
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> j </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> j </span><span class="cpp1-symbol">&lt;&lt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> m </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">			std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">iota</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">y</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> y </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">),</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> y</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">++]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">			memset</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">buf</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> m </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">buf</span><span class="cpp1-symbol">[</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">y</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">];
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> m</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> buf</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+=</span><span class="cpp1-space"> buf</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">--</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">[</span><span class="cpp1-space"> </span><span class="cpp1-symbol">--</span><span class="cpp1-identifier">buf</span><span class="cpp1-symbol">[</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">y</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> y</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">			std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">swap</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> y</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">			x</span><span class="cpp1-symbol">[*</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">cmp</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">y</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">&gt;=</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">break</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rnk </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">x </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">--</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> buf</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">delete</span><span class="cpp1-space"> </span><span class="cpp1-symbol">[]</span><span class="cpp1-space"> y</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">--</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">continue</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> sa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> limit </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> max</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">);</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> limit </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> p</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> p</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">			g</span><span class="cpp1-symbol">[</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-space"> </span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> p</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">		</span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">st </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> g</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> k </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">			k </span><span class="cpp1-symbol">-=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> f </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> g</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> g </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">new</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">k </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">			</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> k</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)
</span><span class="cpp1-space">				g</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> min</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-number">1</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">)]);
</span><span class="cpp1-space">		</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">inline</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">operator</span><span class="cpp1-space"> </span><span class="cpp1-symbol">()</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> u</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">const</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> v</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">		assert</span><span class="cpp1-symbol">((</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">u </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">n </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">v </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">unsigned</span><span class="cpp1-symbol">)</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">u </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> v</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> u</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> L</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> R</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> c</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">tie</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">L</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> R</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">minmax</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">rnk</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">u</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> rnk</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">v</span><span class="cpp1-symbol">]),</span><span class="cpp1-space"> c </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> lg2</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">R </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> L</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> min</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">c</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">L</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> st</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">c</span><span class="cpp1-symbol">][</span><span class="cpp1-identifier">R </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-number">1</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&lt;&lt;</span><span class="cpp1-space"> c</span><span class="cpp1-symbol">)]);
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
};
</span><span class="cpp1-illegalchar">后缀自动机 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str06</span><span class="cpp1-symbol">]:

</span><span class="cpp1-preprocessor">#define q d[p][x]
</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> extend</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> np</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">cnt</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> q </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> np</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(!</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> q</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> nq </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">cnt</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">nq</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> memcpy</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">nq</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> </span><span class="cpp1-number">104</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">		pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">nq</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> nq</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> Q </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> q</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> q </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> Q</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> q </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> nq</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> np</span><span class="cpp1-symbol">;
}
</span><span class="cpp1-preprocessor">#undef q
</span><span class="cpp1-illegalchar">根据后缀自动机构造后缀树 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str07</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">void</span><span class="cpp1-space"> build</span><span class="cpp1-symbol">()</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> c</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> used</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">true</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> cnt</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">--</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(~</span><span class="cpp1-identifier">pos</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">])
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!</span><span class="cpp1-identifier">used</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">];</span><span class="cpp1-space"> j </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">])
</span><span class="cpp1-space">			c </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pos</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]],</span><span class="cpp1-space"> pos</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pos</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">],
</span><span class="cpp1-space">			child</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]][</span><span class="cpp1-reservedword">int</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">c</span><span class="cpp1-symbol">])]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> j</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> used</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">j</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">true</span><span class="cpp1-symbol">;
</span><span class="cpp1-comment">//	dfs(1);
</span><span class="cpp1-symbol">}
</span><span class="cpp1-identifier">Z 算法 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str08</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">void</span><span class="cpp1-space"> Z</span><span class="cpp1-symbol">()</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> M </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">		z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">min</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> M</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(;</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]];</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&gt;</span><span class="cpp1-space"> Max</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> z</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> M </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
}
</span><span class="cpp1-identifier">Manacher 回文串 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str09</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">void</span><span class="cpp1-space"> Manacher</span><span class="cpp1-symbol">()</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> n </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> M </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	t</span><span class="cpp1-symbol">[</span><span class="cpp1-number">0</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> S</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">++]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> s</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">++]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">n</span><span class="cpp1-symbol">++]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">3</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> n</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">){
</span><span class="cpp1-space">		f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">&lt;</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">?</span><span class="cpp1-space"> std</span><span class="cpp1-symbol">::</span><span class="cpp1-identifier">min</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">M </span><span class="cpp1-symbol">*</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">:</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-symbol">(;</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">==</span><span class="cpp1-space"> t</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">-</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]];</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&gt;</span><span class="cpp1-space"> Max</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> Max </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> f</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">i</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> M </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> i</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
}
</span><span class="cpp1-illegalchar">回文自动机 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str10</span><span class="cpp1-symbol">]:

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> get_fail</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(;</span><span class="cpp1-space"> ptr</span><span class="cpp1-symbol">[~</span><span class="cpp1-identifier">val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">]]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">ptr</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> x </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> fail</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">]);</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">;}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> extend</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> </span><span class="cpp1-symbol">&amp;</span><span class="cpp1-identifier">q </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> get_fail</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">)][</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">];
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(!</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> fail</span><span class="cpp1-symbol">[++</span><span class="cpp1-identifier">cnt</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> d</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">get_fail</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">fail</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">])][</span><span class="cpp1-identifier">x</span><span class="cpp1-symbol">],</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">q </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> cnt</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">2</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> q</span><span class="cpp1-symbol">;
}

</span><span class="cpp1-identifier">val</span><span class="cpp1-symbol">[</span><span class="cpp1-number">1</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">-</span><span class="cpp1-number">1</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">0</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> </span><span class="cpp1-symbol">*</span><span class="cpp1-identifier">fail </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> cnt </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-illegalchar">多串后缀自动机 </span><span class="cpp1-symbol">/</span><span class="cpp1-space"> 广义后缀自动机 </span><span class="cpp1-symbol">[</span><span class="cpp1-illegalchar">#str11</span><span class="cpp1-symbol">]:

</span><span class="cpp1-preprocessor">#define q d[p][x]
#define try_split(v) { \
	if (val[p] + 1 == val[q]) v = q; \
	else { \
		int nq = ++cnt; \
		val[nq] = val[p] + 1, memcpy(d[nq], d[q], 104); \
		pa[nq] = pa[q], v = pa[q] = nq; \
		for (int Q = q; p &amp;&amp; q == Q; q = nq, p = pa[p]); \
	} \
}

</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> extend</span><span class="cpp1-symbol">(</span><span class="cpp1-reservedword">int</span><span class="cpp1-space"> x</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> np</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> q</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> try_split</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">)
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> </span><span class="cpp1-symbol">{
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">for</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-symbol">++</span><span class="cpp1-identifier">cnt</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> val</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">+</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">&amp;&amp;</span><span class="cpp1-space"> </span><span class="cpp1-symbol">!</span><span class="cpp1-identifier">q</span><span class="cpp1-symbol">;</span><span class="cpp1-space"> q </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> np</span><span class="cpp1-symbol">,</span><span class="cpp1-space"> p </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">]);
</span><span class="cpp1-space">		</span><span class="cpp1-reservedword">if</span><span class="cpp1-space"> </span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">p</span><span class="cpp1-symbol">)</span><span class="cpp1-space"> try_split</span><span class="cpp1-symbol">(</span><span class="cpp1-identifier">pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">])</span><span class="cpp1-space"> </span><span class="cpp1-reservedword">else</span><span class="cpp1-space"> pa</span><span class="cpp1-symbol">[</span><span class="cpp1-identifier">np</span><span class="cpp1-symbol">]</span><span class="cpp1-space"> </span><span class="cpp1-symbol">=</span><span class="cpp1-space"> </span><span class="cpp1-number">1</span><span class="cpp1-symbol">;
</span><span class="cpp1-space">	</span><span class="cpp1-symbol">}
</span><span class="cpp1-space">	</span><span class="cpp1-reservedword">return</span><span class="cpp1-space"> np</span><span class="cpp1-symbol">;
}
</span><span class="cpp1-preprocessor">#undef q

</span></span>
</code></pre>
</body>
</html>